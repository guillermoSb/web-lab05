<html>
  <head>
    <!-- <link rel="stylesheet" href="styles.css" /> -->
  </head>
  <body>
    <script type="application/javascript">
      const classes = {
        chat: "chat",
        messages: "messages",
        bar: "bar",
        barInput: "bar_input",
        barButton: "bar_button",
        bubbleContainer: "bubble_container",
        bubble: "bubble",
      };
      const contentTypes = {
        text: "txt",
        image: "img",
      };
      const createDiv = () => document.createElement("div");
      const dynamicStyles = {
        buttonNormal: () => {
          return `
            border-radius: 50%;
            color: #ffff;
            border: none;
            background-color: #48bfe3;
            padding: 10px;
            box-shadow: 0 0 4px 2px rgba(83, 144, 217, 0.5);
            transition: all 0.2s;
        `;
        },
        inputNormal: () => {
          return `
            border-radius: 24px;
            border: none;
            background-color: rgba(83, 144, 217, 0.2);
            padding: 10px 20px;
            flex: 1;
            margin-right: 24px;
        `;
        },
        inputFocus: () => {
          return `
                outline: none;
            `;
        },
        buttonHover: () => {
          return `
                cursor: pointer;
            `;
        },
        buttonActive: () => {
          return `
            cursor: pointer;
            box-shadow: none;
            `;
        },
        bubbleContainer: (type) => {
          return `
                justify-content: ${type == "right" ? "end" : "start"};

            `;
        },
        bubbleColor: (type) => {
          return `
                background-color: ${
                  type == "right" ? "rgb(83, 144, 217)" : "rgb(105, 48, 195)"
                };
            `;
        },
        bubbleHover: (type) => {
          return `
                box-shadow: 0 0 4px 2px ${
                  type == "right"
                    ? "rgba(83, 144, 217, 0.5)"
                    : "rgba(105, 48, 195, 0.5)"
                };

            `;
        },
        bubbleNormal: (contentType) => {
          return `
            padding: ${contentType === contentTypes.text ? "10px 15px" : "8px"};
            border-radius: 20px;
            color: #fff;
            width: fit-content;
            max-width: 50%;
            display: block;
            justify-self: center;
            line-height: 1.5rem;
            transition: 0.5s box-shadow;
            overflow: visible;
        `;
        },
        bubbleImage: () => {
          return `
                max-width: 100%;
                border-radius: 20px;
            `;
        },
      };

      const createBubble = (content, type, contentType = contentTypes.text) => {
        const bubbleContainer = createDiv();
        bubbleContainer.classList.add(classes.bubbleContainer);
        const bubble = createDiv();
        bubble.classList.add(classes.bubble);
        bubbleContainer.appendChild(bubble);
        bubbleContainer.style.cssText =
          `
            width: 100%;
            display: flex;
            margin-bottom: 10px;
            overflow: visible;
        ` + dynamicStyles.bubbleContainer(type);
        bubble.style.cssText =
          dynamicStyles.bubbleNormal(contentType) +
          dynamicStyles.bubbleColor(type);
        bubble.addEventListener("mouseenter", () => {
          bubble.style.cssText += dynamicStyles.bubbleHover(type);
        });
        bubble.addEventListener("mouseleave", () => {
          bubble.style.cssText =
            dynamicStyles.bubbleNormal(contentType) +
            dynamicStyles.bubbleColor(type);
        });
        if (contentType === contentTypes.text) {
          bubble.innerHTML = content;
        } else if (contentType === contentTypes.image) {
          const image = document.createElement("img");
          image.setAttribute("src", content);
          image.setAttribute("alt", content);
          image.style.cssText = dynamicStyles.bubbleImage();
          bubble.appendChild(image); // Custom padding when rendering images
        }
        return bubbleContainer;
      };
      // Creating the DOM Initial Nodes
      const createInitialElements = () => {
        let chatContainer = createDiv();
        chatContainer.classList.add(classes.chat);
        // Messages
        let messagesContainer = createDiv();
        messagesContainer.classList.add(classes.messages);
        chatContainer.appendChild(messagesContainer);
        // Bottom Bar
        let barContainer = createDiv();
        barContainer.classList.add(classes.bar);
        // Bottom bar input
        let messageInput = document.createElement("input");
        messageInput.setAttribute("placeholder", "Escribe tu mensaje: ");
        messageInput.setAttribute("type", "text");
        messageInput.id = "message";
        messageInput.classList.add(classes.barInput);
        barContainer.appendChild(messageInput);
        // Bottom bar button
        let messageButton = document.createElement("button");
        messageButton.id = "send";
        messageButton.innerHTML = "â†’";
        messageButton.classList.add(classes.barButton);
        barContainer.appendChild(messageButton);
        chatContainer.appendChild(barContainer);
        // Appending all the DOM Initial Nodes
        document.body.appendChild(chatContainer);
      };
      const createChatStyles = () => {
        document.body.style.cssText += `
          background-color: #edf2f4;
          display: flex;
          align-items: center;
          justify-content: center;
      `;

        const chat = document.getElementsByClassName(classes.chat)[0];
        chat.style.cssText += `
          border-radius: 24px;
          width: 70%;
          height: 60vh;
          border: 2px solid #000;
          display: flex;
          flex-direction: column;
          justify-content: end;
          padding: 24px;
      `;

        const messages = document.getElementsByClassName(classes.messages)[0];
        messages.style.cssText += `
        width: 100%;
        height: 200px;
        margin-bottom: 24px;
        overflow-x: hidden;
        overflow-y: auto;
        flex: 1;
        `;
        const bar = document.getElementsByClassName(classes.bar)[0];
        bar.style.cssText += `
        align-self: flex-end;
        justify-self: center;
        display: flex;
        justify-content: space-between;
        width: 100%;
        `;
        const messageInput = document.getElementById("message");
        message.style.cssText = dynamicStyles.inputNormal();
        const messageButton = document.getElementById("send");
        messageButton.style.cssText = dynamicStyles.buttonNormal();
      };
      const createTestBubbles = () => {
        const messages = document.getElementsByClassName("messages")[0];
        const bubbleContainer1 = createBubble("Hello!", "right");
        const bubbleContainer2 = createBubble(
          "https://c.tenor.com/wb-sYWqJarUAAAAC/the-office.gif",
          "left",
          contentTypes.image
        );
        messages.appendChild(bubbleContainer1);
        messages.appendChild(bubbleContainer2);
      };
      const createDynamicStyles = () => {
        const messageInput = document.getElementById("message");
        messageInput.addEventListener("focus", () => {
          messageInput.style.cssText += dynamicStyles.inputFocus();
        });
        const sendButton = document.getElementById("send");
        sendButton.addEventListener("mouseover", () => {
          sendButton.style.cssText += dynamicStyles.buttonHover();
        });
        sendButton.addEventListener("mousedown", () => {
          sendButton.style.cssText += dynamicStyles.buttonActive();
        });
        sendButton.addEventListener("mouseup", () => {
          sendButton.style.cssText = dynamicStyles.buttonNormal();
          sendButton.style.cursor = "pointer"; // Keep the pointer
        });
      };
      const createSendEventListeners = () => {
        const messageInput = document.getElementById("message");
        const messageButton = document.getElementById("send");
        const messages = document.getElementsByClassName("messages")[0];
        messageButton.addEventListener("click", () => {
          const message = messageInput.value;
          if (message && message.length > 0 && message.length <= 140) {
            messages.appendChild(createBubble(message, "right"));
            messages.scrollTop = messages.scrollHeight;
            console.log(message.length);
            messageInput.value = ""; // reset the value
          } else if (message && message.length > 140) {
            alert("No puedes enviar un mensaje con mas de 140 caracteres.");
          }
        });
        messageInput.addEventListener("keyup", (event) => {
          // Number 13 is the "Enter" key on the keyboard
          if (event.keyCode === 13) {
            // Cancel the default action, if needed
            event.preventDefault();
            messageButton.click();
          }
        });
      };

      const sendMessage = (content) => {
        createBubble(content, "right");
      };
      // Creating the DOM Elements Styles
      createInitialElements();
      createChatStyles();
      createDynamicStyles();
      createSendEventListeners();
      createTestBubbles();
      // Chat Logic
    </script>
  </body>
</html>
